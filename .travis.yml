jobs:
  include:
    - stage: test
      env: Type='virus scan'
      script:
        - sudo apt-get install clamav -y
        - sudo freshclam
        - clamscan --quiet -r ./
    - stage: test
      env: Type='build'
      language: csharp
      dotnet: 2.1.3
      mono: latest
      before_script:
        - nvm install 8
      script:
        - npm i
        - npm run restore
        - dotnet fable npm-run build
    - stage: test
      env: Type='unit test'
      language: csharp
      dotnet: 2.1.3
      mono: latest
      before_script:
        - nvm install 8
        - npm install -g codecov
      script:
        - npm i
        - npm run restore
        - npm run test
      after_success:
        - codecov
    - stage: deploy
      language: csharp
      dotnet: 2.1.3
      mono: latest
      if: branch =~ ^v\d+\.\d+\.\d+$
      before_deploy:
        - nvm install 8
        - npm install -g codecov
        - dotnet fable npm-run build
      deploy:
        skip_cleanup: true
        provider: npm
        email: "$NPM_EMAIL"
        api_key: "$NPM_TOKEN"
        on:
          tags: true
          repo: intel-hpdd/device-scanner